"use client";

import { useMemo } from "react";
import { useLocationStore } from "@/store/locationStore";
import { Business } from "@/types/business";

// Available mock images
const mockImages = [
    "/images/mockedData/businessPfp.png",
    "/images/mockedData/businessGalleryItem.png",
    "/images/mockedData/eventImageMain.png",
    "/images/mockedData/eventImageSecondary.jpg",
    "/images/mockedData/girl.jpg",
    "/images/mockedData/individualPfp.png",
    "/images/mockedData/businessPfp.png",
    "/images/mockedData/businessGalleryItem.png",
];

// Helper function to generate 8 gallery images
const generateGalleryImages = (index: number): string[] => {
    return Array.from({ length: 8 }, (_, i) => {
        const imageIndex = (index * 8 + i) % mockImages.length;
        return mockImages[imageIndex];
    });
};

const generateFakeBusinesses = (lat: number, lng: number): Business[] => {
    const names = [
        {
            name: "Мастер маникюра Елена",
            desc: "Профессиональный мастер маникюра с выездом на дом. Выполняю классический, аппаратный и комбинированный маникюр, покрытие гель-лаком и педикюр. Работаю строго по стерильным протоколам. Индивидуальный подход к каждому клиенту. Использую только проверенные материалы. Возможна запись в удобное для вас время. Вежливое обслуживание, уютная атмосфера и идеальные ногти без спешки и очередей.",
        },
        {
            name: "Ремонт авто Александр",
            desc: "Автомеханик с более чем 10-летним опытом работы. Предлагаю услуги выездного ремонта и технического обслуживания: диагностика двигателя, подвески, тормозной системы, замена масла, фильтров, свечей, аккумуляторов и многое другое. Работаю с любыми марками авто. Выезжаю оперативно, точно по адресу. Без необходимости тянуть машину в сервис. Качественно, честно, с гарантийным подходом и объяснением всех нюансов ремонта.",
        },
        {
            name: "Парикмахер Наталья",
            desc: "Опытный парикмахер-универсал с выездом на дом. Выполняю женские, мужские и детские стрижки, окрашивания любой сложности, мелирование, балаяж, тонирование, вечерние укладки и причёски. Всегда учитываю форму лица и структуру волос. Работаю на качественной профессиональной косметике. Индивидуальный подход, уютная домашняя атмосфера и безупречный результат. Запись по телефону, возможны срочные визиты в удобное для вас время.",
        },
        {
            name: "Веломастер Игорь",
            desc: "Мобильный веломеханик с выездом по городу. Быстро и надёжно починю велосипед на месте: настройка тормозов, переключателей, выравнивание колес, замена камер и цепи, сезонное обслуживание. Работаю с горными, шоссейными, городскими и детскими велосипедами. Приезжаю с инструментом и всем необходимым. Гарантирую точную диагностику и качественный ремонт. Идеально подходит тем, кто не хочет везти велик в мастерскую.",
        },
        {
            name: "Фотоуслуги Анна",
            desc: "Профессиональный фотограф для всех важных моментов жизни. Провожу индивидуальные, семейные, детские и парные фотосессии, съёмки мероприятий, корпоративов, утренников и дней рождения. Создаю живые и эмоциональные кадры, подсказываю позы, помогаю чувствовать себя уверенно. Работаю с естественным светом и студийным оборудованием. Гарантирую качественную обработку фотографий и бережное отношение к вашему времени и настроению.",
        },
        {
            name: "Повар на заказ Виктория",
            desc: "Частный повар с выездом. Приготовлю блюда европейской, украинской, азиатской и вегетарианской кухни прямо у вас дома. Провожу семейные ужины, дни рождения, фуршеты, кейтеринг на небольшие мероприятия. Работаю с качественными продуктами, создаю красивую подачу и уютную атмосферу. Помогу с составлением меню под ваши вкусы и бюджет. Всё свежее, вкусное, как в ресторане, но у вас на кухне и без суеты.",
        },
        {
            name: "Репетитор английского Марина",
            desc: "Преподаю английский язык для школьников, студентов и взрослых с любым уровнем подготовки. Индивидуальные занятия онлайн или с выездом. Помогаю освоить разговорную речь, грамматику, лексику и подготовиться к ЗНО, ДПА, TOEFL, IELTS. Использую современные методики, интерактивные материалы и адаптирую программу под цели ученика. Дружелюбная атмосфера, регулярная практика и заметный результат уже через несколько недель.",
        },
    ];

    // Default Calendly URL for testing
    const DEFAULT_CALENDLY_URL = "https://calendly.com/shade09876";

    return Array.from({ length: 20 }, (_, i) => {
        const latOffset = (Math.random() - 0.5) * 0.01;
        const lngOffset = (Math.random() - 0.5) * 0.01;
        const base = names[i % names.length];

        return {
            id: `business-${i + 1}`,
            userType: i % 2 === 0 ? "business" : "individual",
            title: base.name,
            description: base.desc,
            imageUrls: generateGalleryImages(i),
            location: [lat + latOffset, lng + lngOffset] as [number, number],
            category: "services",
            languages: ["ru", "uk"],
            tags: ["услуги", "выезд"],
            creatorId: `user-${i + 1}`,
            calendlyUrl: DEFAULT_CALENDLY_URL,
        };
    });
};

export const useNearbyBusinesses = (): Business[] => {
    const userLocation = useLocationStore(s => s.userLocation);

    const businesses = useMemo(() => {
        if (!userLocation) return [];
        const [lat, lng] = userLocation;
        return generateFakeBusinesses(lat, lng);
    }, [userLocation?.[0], userLocation?.[1]]); // ключове — лише коли координати справді змінились

    return businesses;
};
